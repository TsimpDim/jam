<div class="main-container">
    <app-header></app-header>
  
  
    <div class="content-container">
      <div class="content-area">
        <h6 *ngIf="selectedApp == null">
            Please select an application from the menu on the left.
        </h6>

        <div class="clr-column" *ngIf="selectedApp != null">
            <h4>Job Application</h4>
            <div class="card">
                <div class="card-header">
                    {{selectedApp.company}} - {{selectedApp.location}}
                    <span class="badge" style="font-size: .7em;float:right">{{selectedApp.date}}</span>
                    <span class="badge badge-light-blue" style="font-size: .7em;float:right">{{selectedApp.status}}</span>
                </div>
                <div class="card-block">
                    <div class="card-title">
                        {{selectedApp.role}}
                    </div>
                    <div class="card-text">
                    {{selectedApp.notes}}
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-sm btn-link" (click)="openJobAppModal()">Edit</button>
                </div>
            </div>

            <h4>Timeline</h4>
            
            <ul class="clr-timeline clr-timeline-vertical">
                <li class="clr-timeline-step" *ngFor="let tl of selectedAppTimeline">
                    <div class="clr-timeline-step-header">{{tl.date}}</div>
                    <cds-icon shape="circle" [style.color]="tl.step.color"></cds-icon>
                    <div class="clr-timeline-step-body"  (click)="openEditTimelineModal(tl.id)">
                        <div class="clr-timeline-step-title">{{tl.step.name}}</div>
                        <div class="clr-timeline-step-description">{{tl.notes}}</div>
                    </div>
                </li>
            </ul>

            <button class="btn btn-success" style="margin-top: 2em;" (click)="openTimelineStepModal()">Add step</button>
        </div>
    </div>


    <clr-vertical-nav [clrVerticalNavCollapsible]="true">
        <a clrVerticalNavLink (click)="openAndClearJobAppModal()">Add New Application</a>
        <clr-vertical-nav-group *ngFor="let group of applications | keyvalue">
            {{group.key}} <span class="badge" style="margin-left: .5em;">{{$any(group).value.length}}</span>
            <clr-vertical-nav-group-children *ngFor="let app of $any(group).value">
                <a clrVerticalNavLink (click)="selectApp(group.key,app.id)">{{app.company}} // {{app.role}}</a>
            </clr-vertical-nav-group-children>
        </clr-vertical-nav-group>
    </clr-vertical-nav>



    <clr-modal [(clrModalOpen)]="creationModalIsOpen">
        <h3 class="modal-title" >Add Job Application</h3>
      
        <div class="modal-body">
          <form class="clr-form clr-form-horizontal" [formGroup]="jobAppForm">
            <div class="clr-form-control">
                <label for="company" class="clr-control-label">Company</label>
                <div class="clr-control-container">
                    <div class="clr-input-wrapper">
                        <input clrInput
                        type="text"
                        name="company"
                        formControlName="company"
                        />
                    </div>
                </div>
            </div>

            <div class="clr-form-control">
                <label for="role" class="clr-control-label">Role</label>
                <div class="clr-control-container">
                    <div class="clr-textarea-wrapper">
                        <input clrInput
                        type="text"
                        name="role"
                        formControlName="role"
                        />
                    </div>
                </div>
            </div>

            <div class="clr-form-control">
                <label for="location" class="clr-control-label">Location</label>
                <div class="clr-control-container">
                    <div class="clr-textarea-wrapper">
                        <input clrInput
                        type="text"
                        name="location"
                        formControlName="location"
                        />
                    </div>
                </div>
            </div>

            <div class="clr-form-control">
                <label for="notes" class="clr-control-label">Notes</label>
                <div class="clr-control-container">
                    <div class="clr-textarea-wrapper">
                        <textarea
                        class="clr-textarea"
                        name="notes"
                        formControlName="notes"
                        ></textarea>
                    </div>
                </div>
            </div>

            <div class="clr-form-control">
                <label for="date" class="clr-control-label">Date</label>
                <clr-date-container>
                    <input clrDate type="date" name="date" formControlName="date"/>
                </clr-date-container>
            </div>

            <div class="clr-form-control">
                <label for="group" class="clr-control-label">Group</label>
                <select clrSelect name="group" formControlName="group">
                    <option *ngFor="let group of groups" [value]="group.id">{{group.name}}</option>
                </select>
            </div>

            <div class="clr-form-control" *ngIf="selectedApp === null">
                <label for="initialStep" class="clr-control-label">Initial Step</label>
                <select clrSelect name="initialStep" formControlName="initialStep">
                    <option *ngFor="let step of initialSteps" [value]="step.id">{{step.name}}</option>
                </select>
            </div>
          </form>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-danger-outline"
            (click)="deleteJobApp(selectedApp.id)"
            *ngIf="selectedApp !== null"
            >
            Delete
            </button>
            <button type="button" class="btn btn-outline" (click)="closeJobAppModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" (click)="submitJobAppForm()">Submit</button>
        </div>
    </clr-modal>

    <clr-modal [(clrModalOpen)]="timelineStepModalIsOpen">
        <h3 class="modal-title" *ngIf="selectedTimelineStep == null">Add Step</h3>
        <h3 class="modal-title" *ngIf="selectedTimelineStep != null">Edit Step</h3>
      
        <div class="modal-body">
          <form class="clr-form clr-form-horizontal" [formGroup]="timelineStepForm">
            <div class="clr-form-control">
                <label for="step" class="clr-control-label">Step</label>
                <select clrSelect name="step" formControlName="step" *ngIf="selectedTimelineStep == null">
                    <option *ngFor="let step of nonStartingSteps" [value]="step.id">{{step.name}}</option>
                </select>

                <input
                clrInput
                type="text"
                disabled
                *ngIf="selectedTimelineStep !== null"
                value="{{selectedTimelineStep.step.name}}">
            </div>

            <div class="clr-form-control">
                <label for="notes" class="clr-control-label">Notes</label>
                <div class="clr-control-container">
                    <div class="clr-textarea-wrapper">
                        <textarea
                        class="clr-textarea"
                        name="notes"
                        formControlName="notes"
                        ></textarea>
                    </div>
                </div>
            </div>

            <div class="clr-form-control">
                <label for="date" class="clr-control-label">Date</label>
                <clr-date-container>
                    <input clrDate type="date" name="date" formControlName="date"/>
                </clr-date-container>
            </div>
          </form>
        </div>


        <div class="modal-footer">
            <button type="button" class="btn btn-danger-outline"
            (click)="deleteTimelineStep()"
            *ngIf="selectedTimelineStep !== null"
            >
            Delete
            </button>
            <button type="button" class="btn btn-outline" (click)="closeTimelineStepModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" (click)="submitTimelineStepForm()">Submit</button>
        </div>
    </clr-modal>
</div>